/*! For license information please see contentScript.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){e=function(){return n};var r,n={},o=Object.prototype,i=o.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function h(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(r){h=function(t,e,r){return t[e]=r}}function p(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,i=Object.create(o.prototype),c=new T(n||[]);return a(i,"_invoke",{value:P(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}n.wrap=p;var d="suspendedStart",y="suspendedYield",m="executing",v="completed",g={};function w(){}function b(){}function x(){}var k={};h(k,s,(function(){return this}));var L=Object.getPrototypeOf,E=L&&L(L(C([])));E&&E!==o&&i.call(E,s)&&(k=E);var S=x.prototype=w.prototype=Object.create(k);function _(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function O(e,r){function n(o,a,c,s){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==t(h)&&i.call(h,"__await")?r.resolve(h.__await).then((function(t){n("next",t,c,s)}),(function(t){n("throw",t,c,s)})):r.resolve(h).then((function(t){l.value=t,c(l)}),(function(t){return n("throw",t,c,s)}))}s(u.arg)}var o;a(this,"_invoke",{value:function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}})}function P(t,e,n){var o=d;return function(i,a){if(o===m)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:r,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=A(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=f(t,e,n);if("normal"===u.type){if(o=n.done?v:y,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function A(t,e){var n=e.method,o=t.iterator[n];if(o===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=r,A(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=f(o,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,g;var a=i.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,g):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,g)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function C(e){if(e||""===e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function t(){for(;++o<e.length;)if(i.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=r,t.done=!0,t};return a.next=a}}throw new TypeError(t(e)+" is not iterable")}return b.prototype=x,a(S,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:b,configurable:!0}),b.displayName=h(x,l,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,h(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},n.awrap=function(t){return{__await:t}},_(O.prototype),h(O.prototype,u,(function(){return this})),n.AsyncIterator=O,n.async=function(t,e,r,o,i){void 0===i&&(i=Promise);var a=new O(p(t,e,r,o),i);return n.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(S),h(S,l,"Generator"),h(S,s,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},n.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(I),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,o){return c.type="throw",c.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:C(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),g}},n}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function n(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}var o='You are ShikShakShop, a fashion-focused AI shopping assistant. Provide contextual guidance based on specific use cases.\n\nKey Guidelines:\n1. Conversation Flow:\n   • Start with broad understanding (item type, general purpose)\n   • Ask only 1-2 questions at a time\n   • Wait for user response before asking more questions\n   • Progress from general to specific details\n\n2. Question Priority Order:\n   1. Basic item and purpose understanding\n   2. Gender and age group\n   3. Budget expectations\n   4. Style preferences\n   5. Practical requirements\n   6. Specific details (size, color, etc.)\n\n3. Response Format:\n   • Keep responses concise and friendly\n   • Ask one clear question at a time\n   • When making recommendations:\n      • Research current trends and popular options\n      • Consider regional availability and shipping\n      • Include mix of mainstream and boutique options\n      • Suggest alternatives if exact match unavailable\n      • Consider sustainability and ethical factors\n      • Include price comparisons when possible\n      • ALWAYS include at least 3 search links in this format:\n      • For Amazon: [Product Name](https://www.amazon.com/s?k=search+term&rh=p_36:min_price-max_price,p_size_browse-vebin:size)\n      Example with filters:\n      • [Cotton Saree under $50](https://www.amazon.com/s?k=cotton+saree&rh=p_36:1000-5000)\n      • [Medium Size Dress](https://www.amazon.com/s?k=dress&rh=p_size_browse-vebin:Medium)\n      • [Large Blue Jacket under $100](https://www.amazon.com/s?k=blue+jacket&rh=p_36:1000-10000,p_size_browse-vebin:Large)\n      \n      Search URL formats to use:\n        - Amazon: https://www.amazon.com/s?k=search_term&rh=p_36:(price*0.85)-(price*1.15),p_size_browse-vebin:size\n        - Macy\'s: https://www.macys.com/shop/featured/search_term?sortBy=PRICE_LOW_TO_HIGH&prefv1=REGULAR&prefn1=PriceRange&prefv2=under_%upper%|%lower%_to_%upper%\n        - Nordstrom: https://shop.nordstrom.com/sr?keyword=search+term\n        - ZARA: https://www.zara.com/us/en/search?searchTerm=search+term\n        - ASOS: https://www.asos.com/us/search/?q=search+term\n\n4. Example Progressive Flow:\n   User: "Looking for a winter jacket"\n   AI: "I\'d love to help you find the perfect winter jacket! First, will this be for work, casual wear, or outdoor activities?"\n   User: "For work"\n   AI: "Got it! Could you tell me if you\'re looking for something business professional or more business casual?"\n   (Continue narrowing down...)\n\nRemember:\n• Don\'t overwhelm with multiple questions\n• Build context gradually\n• Make each question feel natural and conversational\n• Save detailed preferences for later in the conversation\n\nStart each interaction with:\n"Let\'s ShikShakShop! Tell me what fashion piece you\'re dreaming of today."';function i(t){return a.apply(this,arguments)}function a(){var t;return t=e().mark((function t(n){var i,a,c,s,u,l,h,p=arguments;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=p.length>1&&void 0!==p[1]?p[1]:"",t.prev=1,t.next=4,chrome.storage.local.get("openai_key");case 4:if((a=t.sent).openai_key){t.next=7;break}return t.abrupt("return","Please set your OpenAI API key in the extension settings.");case 7:return c=i?"".concat(o,"\n\nCurrent product context:\n").concat(i):o,console.log("Sending request to OpenAI...",{messages:n}),t.next=11,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.openai_key)},body:JSON.stringify({model:"gpt-4-turbo-preview",messages:[{role:"system",content:c}].concat((e=n,function(t){if(Array.isArray(t))return r(t)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())),temperature:.7,max_tokens:500})});case 11:if((s=t.sent).ok){t.next=18;break}return t.next=15,s.json();case 15:return l=t.sent,console.error("OpenAI API Error:",l),t.abrupt("return","API Error: ".concat((null===(u=l.error)||void 0===u?void 0:u.message)||"Unknown error"));case 18:return t.next=20,s.json();case 20:return h=t.sent,console.log("OpenAI Response:",h),t.abrupt("return",h.choices[0].message.content);case 25:return t.prev=25,t.t0=t.catch(1),console.error("AI Error:",t.t0),t.abrupt("return","Error: ".concat(t.t0.message,". Please check your API key and try again."));case 29:case"end":return t.stop()}var e}),t,null,[[1,25]])})),a=function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function c(t){n(a,o,i,c,s,"next",t)}function s(t){n(a,o,i,c,s,"throw",t)}c(void 0)}))},a.apply(this,arguments)}function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function s(){s=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function h(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,r){return t[e]=r}}function p(t,e,r,n){var i=e&&e.prototype instanceof w?e:w,a=Object.create(i.prototype),c=new T(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=p;var d="suspendedStart",y="suspendedYield",m="executing",v="completed",g={};function w(){}function b(){}function x(){}var k={};h(k,a,(function(){return this}));var L=Object.getPrototypeOf,E=L&&L(L(C([])));E&&E!==r&&n.call(E,a)&&(k=E);var S=x.prototype=w.prototype=Object.create(k);function _(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,i,a,s){var u=f(t[o],t,i);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==c(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=d;return function(i,a){if(o===m)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=A(c,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:y,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function A(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,A(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function C(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(c(e)+" is not iterable")}return b.prototype=x,o(S,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=h(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,h(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},_(O.prototype),h(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(p(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(S),h(S,l,"Generator"),h(S,a,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=C,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:C(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function u(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}var l=null;function h(){try{var t,e,r=(null===(t=document.getElementById("productTitle"))||void 0===t?void 0:t.textContent.trim())||"",n=document.querySelector(".a-price .a-offscreen"),o=(null==n?void 0:n.textContent.trim())||"",i=document.querySelector("#acrPopover"),a=(null==i?void 0:i.title.trim())||"",c=(null===(e=document.getElementById("acrCustomerReviewText"))||void 0===e?void 0:e.textContent.trim())||"";return"Product: ".concat(r,"\nPrice: ").concat(o,"\nRating: ").concat(a," (").concat(c,")").trim()}catch(t){return console.error("Error getting product context:",t),""}}chrome.runtime.onMessage.addListener((function(t,e,r){return console.log("Message received:",t),"toggle"===t.action&&(l?l.style.display="none"===l.style.display?"block":"none":l=function(){console.log("Creating chat interface...");var t=document.createElement("div");t.id="shikshak-assistant",t.style.cssText="\n    position: fixed;\n    right: 20px;\n    bottom: 20px;\n    width: 300px;\n    height: 400px;\n    background: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n    z-index: 9999;\n    display: block;\n    font-family: Arial, sans-serif;\n  ";var e=document.createElement("style");e.textContent="\n    .message {\n      margin: 15px 0;\n      padding: 12px 15px;\n      border-radius: 15px;\n      max-width: 85%;\n      line-height: 1.4;\n    }\n    \n    .user-message {\n      background: #6B46C1;\n      color: white;\n      margin-left: auto;\n      border-bottom-right-radius: 5px;\n    }\n    \n    .ai-message {\n      background: white;\n      color: #2D3748;\n      margin-right: auto;\n      border-bottom-left-radius: 5px;\n      border: 1px solid #E2E8F0;\n    }\n  ",document.head.appendChild(e),t.innerHTML='\n    <div style="padding: 16px; display: flex; flex-direction: column; height: 100%; box-sizing: border-box;">\n      <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">\n        <h3 style="margin: 0;">ShikShakShop</h3>\n        <button id="close-chat" style="border: none; background: none; cursor: pointer;">×</button>\n      </div>\n      <div id="chat-messages" style="\n        flex-grow: 1;\n        overflow-y: auto;\n        margin-bottom: 16px;\n        padding: 10px;\n        background: #f8f9fa;\n        border-radius: 4px;\n      "></div>\n      <div style="display: flex; gap: 8px;">\n        <input type="text" id="chat-input" placeholder="Type your message..." style="\n          flex-grow: 1;\n          padding: 8px;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          outline: none;\n        ">\n        <button id="send-message" style="\n          padding: 8px 16px;\n          background: #0066cc;\n          color: white;\n          border: none;\n          border-radius: 4px;\n          cursor: pointer;\n        ">Send</button>\n      </div>\n    </div>\n  ',document.body.appendChild(t);var r=[{role:"assistant",content:"Let's ShikShakShop! Tell me what fashion piece you're dreaming of today."}];function n(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log("Adding message:",e,"isUser:",n);var o=t.querySelector("#chat-messages"),i=document.createElement("div");i.className="message ".concat(n?"user-message":"ai-message");var a=e.replace(/\[(.*?)\]\((.*?)\)/g,(function(t,e,r){return'<a href="'.concat(r,'" target="_blank" style="\n        color: ').concat(n?"white":"#6B46C1",';\n        text-decoration: underline;\n        cursor: pointer;\n      ">').concat(e,"</a>")}));i.innerHTML=a,o.appendChild(i),o.scrollTop=o.scrollHeight,r.push({role:n?"user":"assistant",content:e})}function o(){return a.apply(this,arguments)}function a(){var e;return e=s().mark((function e(){var o,a,c,u,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.querySelector("#chat-input"),!(a=o.value.trim())){e.next=24;break}return c="",window.location.hostname.includes("amazon.com")&&(c=h()),n(a,!0),o.value="",(u=document.createElement("div")).textContent="Typing...",u.style.cssText="\n        margin: 8px 0;\n        padding: 8px 12px;\n        color: #666;\n        font-style: italic;\n      ",t.querySelector("#chat-messages").appendChild(u),e.prev=11,e.next=14,i(r,c);case 14:l=e.sent,u.remove(),n(l),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(11),console.error("Chat Error:",e.t0),u.remove(),n("Sorry, I encountered an error. Please try again.");case 24:case"end":return e.stop()}}),e,null,[[11,19]])})),a=function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(t){u(i,n,o,a,c,"next",t)}function c(t){u(i,n,o,a,c,"throw",t)}a(void 0)}))},a.apply(this,arguments)}return console.log("Initial message:",r[0].content),t.querySelector("#send-message").addEventListener("click",o),t.querySelector("#chat-input").addEventListener("keypress",(function(t){"Enter"===t.key&&o()})),t.querySelector("#close-chat").addEventListener("click",(function(){t.style.display="none"})),setTimeout((function(){n(r[0].content,!1)}),100),t}(),console.log("Chat visibility:",l.style.display),r({success:!0})),!0}))})();